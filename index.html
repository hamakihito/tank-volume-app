<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>タンク容量計算</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    label { display: block; margin-top: 1em; }
    input, select { padding: 0.5em; font-size: 1em; }
    .output { margin-top: 1em; font-size: 1.2em; color: darkgreen; }
  </style>
  <script src="t1_data_embed_full.js"></script>
</head>
<body>
  <h1>タンク容量計算</h1>

  <label>
    タンク番号:
    <select id="tankSelect">
      <option value="T1">T1</option>
    </select>
  </label>

  <label>
    深さ（mm）:
    <input type="number" id="depthInput" min="0" step="1" />
  </label>

  <div class="output">
    容量: <span id="volumeOutput">-</span> L
  </div>

  <script>
    const tankSelect = document.getElementById("tankSelect");
    const depthInput = document.getElementById("depthInput");
    const volumeOutput = document.getElementById("volumeOutput");

    function findVolume(tankNo, depth) {
      const data = tankData[tankNo];
      if (!data) return null;

      // 完全一致を探す
      const exact = data.find(d => d.depth === depth);
      if (exact) return exact.volume;

      // 補間（近い下限と上限の間で線形補間）
      const lower = [...data].reverse().find(d => d.depth < depth);
      const upper = data.find(d => d.depth > depth);
      if (lower && upper) {
        const ratio = (depth - lower.depth) / (upper.depth - lower.depth);
        return Math.round(lower.volume + ratio * (upper.volume - lower.volume));
      }

      return null; // 範囲外
    }

    function updateVolume() {
      const tankNo = tankSelect.value;
      const depth = parseInt(depthInput.value, 10);
      if (isNaN(depth)) {
        volumeOutput.textContent = "-";
        return;
      }
      const volume = findVolume(tankNo, depth);
      volumeOutput.textContent = volume !== null ? volume.toLocaleString() : "範囲外";
    }

    depthInput.addEventListener("input", updateVolume);
    tankSelect.addEventListener("change", updateVolume);
  </script>
</body>
</html>
